(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{114:function(t,n,e){"use strict";var s=e(73);e.n(s).a},122:function(t,n){},133:function(t,n,e){"use strict";var s=e(75);e.n(s).a},134:function(t,n,e){"use strict";var s=e(76);e.n(s).a},137:function(t,n,e){"use strict";e.r(n);var s=e(92),o={components:{Button:s.a,Input:s.c},inject:["$app"],data:()=>({hoverSettings:!1}),methods:{attachMediumZoom(){this.$vuepress.mediumZoom.update("img.title-image")},toAboutPage(){this.$router.push(this.UZKK_KILLGAME_BASE+"about.html")}}},a=(e(114),e(0)),i=Object(a.a)(o,function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("h1",{staticClass:"tac"},[t._v("人类杀游戏")]),t._v(" "),e("img",{staticClass:"tac title-image",attrs:{alt:"newspaper",src:"/killgame/assets/img/newspaper.jpg"},on:{load:t.attachMediumZoom}}),t._v(" "),e("div",{staticClass:"setting-container"},[e("span",[t._v("昵称：")]),t._v(" "),e("Input",{attrs:{placeholder:"请输入昵称",size:1.1,inactive:!t.hoverSettings},on:{enter:function(n){return t.$app.login()}},nativeOn:{mouseenter:function(n){t.hoverSettings=!0},mouseleave:function(n){t.hoverSettings=!1}},model:{value:t.$app.username,callback:function(n){t.$set(t.$app,"username",n)},expression:"$app.username"}})],1),t._v(" "),e("div",{staticClass:"button-container"},[e("Button",{attrs:{disabled:!t.$app.isReadyForLogin},on:{click:t.$app.login}},[2===t.$app.clientState?[t._v("\n        无法连接至服务器\n      ")]:1===t.$app.clientState?[e("i",{staticClass:"icon-loading"}),t._v("正在连接服务器"),e("i",{staticClass:"icon-loading"})]:1===t.$app.lobbyState?[e("i",{staticClass:"icon-loading"}),t._v("正在进入大厅"),e("i",{staticClass:"icon-loading"})]:[t._v("\n        进入大厅\n      ")]],2),t._v(" "),e("Button",{on:{click:t.toAboutPage}},[t._v("\n      关于人类杀\n    ")])],1)])},[],!1,null,"5e04f074",null).exports,r=e(78),l={components:{Button:s.a,Input:s.c,CollapseView:s.b},inject:["$app"],data:()=>({currentRoom:null}),methods:{}},c=(e(133),Object(a.a)(l,function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("h1",{staticClass:"tac"},[t._v("游戏大厅")]),t._v(" "),e("div",{staticClass:"section"},[e("h3",[t._v("用户名："+t._s(t.$app.username))])]),t._v(" "),e("div",{staticClass:"section"},[e("h3",[t._v("当前在线用户")]),t._v(" "),e("ul",t._l(t.$app.users,function(n,s){var o=n.name;return e("li",{key:s},[t._v("\n        "+t._s(o)+" "),e("span",{staticClass:"id"},[t._v("("+t._s(s)+")")])])}),0)]),t._v(" "),e("div",{staticClass:"section"},[e("div",{staticClass:"setting-container"},[e("span",[t._v("房间名：")]),t._v(" "),e("Input",{attrs:{placeholder:"请输入房间名"},model:{value:t.$app.roomname,callback:function(n){t.$set(t.$app,"roomname",n)},expression:"$app.roomname"}})],1),t._v(" "),e("div",{staticClass:"button-container"},[e("Button",{attrs:{disabled:!t.$app.roomname},on:{click:t.$app.createRoom}},[t._v("创建")])],1)]),t._v(" "),e("collapse-view",{staticClass:"section",attrs:{initial:"open"}},[e("h3",{attrs:{slot:"header"},slot:"header"},[t._v("当前房间列表")]),t._v(" "),t.$app.rooms.length?e("table",{staticClass:"available-rooms"},[e("tr",[e("td",[t._v("房间号")]),t._v(" "),e("td",[t._v("房间名称")]),t._v(" "),e("td",[t._v("已有人数")]),t._v(" "),e("td",[t._v("房主")]),t._v(" "),e("td")]),t._v(" "),t._l(t.$app.rooms,function(n,s){return e("tr",{key:s},[e("td",[t._v(t._s(n.id))]),t._v(" "),e("td",[t._v(t._s(n.name))]),t._v(" "),e("td",[t._v(t._s(n.clients.length))]),t._v(" "),e("td",[t._v(t._s(t.$app.users[n.ownerId].name))]),t._v(" "),e("td",[e("a",{on:{click:function(e){return e.stopPropagation(),t.$app.joinRoom(n.id)}}},[t._v("加入")])])])})],2):e("p",[t._v("\n      当前没有房间。\n    ")])]),t._v(" "),e("div",{staticClass:"button-container"},[e("Button",{attrs:{type:"warning"},on:{click:t.$app.logout}},[t._v("\n      返回主页\n    ")])],1)],1)},[],!1,null,"b2e9c348",null).exports);const u=1,p=()=>({username:"",roomname:"",maxClients:16,roomPassword:""});function d(){const t=p();if("undefined"==typeof localStorage)return t;const n=localStorage.getItem("uzkk.killgame.settings");if(!n)return t;try{const{version:e,settings:s}=JSON.parse(n);return e===u?{...t,...s}:t}catch(e){return console.warn("An error was encounted when parsing settings:\n"+n),t}}function m(t){const n={};for(const e in p())n[e]=t[e];if("undefined"!=typeof localStorage)try{const t={version:u,settings:n};localStorage.setItem("uzkk.killgame.settings",JSON.stringify(t))}catch(t){console.warn("An error was encounted when stringifying settings."),console.warn(t)}return n}const h={rooms(t){this.rooms=t.map(t=>(t.name=decodeURIComponent(t.name),t))},users(t){this.users=t;for(const n in t)this.users[n].name=decodeURIComponent(t[n].name)}};var v={data:()=>({...d(),clientState:2,lobbyState:2,roomname:"",phase:"Entry",rooms:[],users:{}}),computed:{isReady(){return!this.clientState&&!this.lobbyState},isReadyForLogin(){return this.username&&!this.clientState&&2===this.lobbyState}},mounted(){const t=new r.Client(this.UZKK_KILLGAME_SERVER);this.clientState=1,t.onOpen.addOnce(()=>{this.client=t,this.clientState=0,this.login(!1)}),t.onClose.addOnce(()=>{this.client=null,this.clientState=2,this.phase="Entry"}),t.onError.add(t=>{console.error("Client error:",t)})},methods:{login(t=!0){if(!this.isReadyForLogin)return;const n=this.client.join("killgame-lobby",{name:encodeURIComponent(this.username)});this.lobbyState=1,n.onJoin.addOnce(()=>{this.lobby=n,this.lobbyState=0,n.onMessage.add(t=>{t.type in h?h[t.type].call(this,t.data):console.warn("Unknown message:",t)}),t&&m(this),this.phase="Lobby"}),n.onLeave.addOnce(()=>{this.lobby=null,this.lobbyState=2,this.phase="Entry"}),n.onError.add(t=>{console.error("Lobby error:",t)})},logout(t=!0){this.lobby&&(this.username="",t&&m(this),this.lobby.leave(),this.phase="Entry")},createRoom(){if(this.clientState)return;const t=this.client.join("killgame",{create:!0,name:encodeURIComponent(this.roomname),userId:this.client.id});this.monitorRoom(t)},joinRoom(t){if(this.clientState||!t)return;const n=this.client.join(t,{userId:this.client.id});this.monitorRoom(n)},monitorRoom(t){t.onJoin.add(()=>{this.currentRoom=t}),t.onLeave.add(()=>{this.currentRoom=null}),t.onStateChange.add(t=>{console.log("update: ",t)})}}},_={components:{Entry:i,Lobby:c,FadeSlideTransition:e(14).a},mixins:[v],provide(){return{$app:this}}},g=(e(134),Object(a.a)(_,function(){var t=this.$createElement,n=this._self._c||t;return n("FadeSlideTransition",[n(this.phase,{key:this.phase,tag:"component",staticClass:"killgame"})],1)},[],!1,null,null,null));n.default=g.exports},73:function(t,n,e){},75:function(t,n,e){},76:function(t,n,e){}}]);